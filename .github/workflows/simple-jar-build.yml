name: Simple JAR Build

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4
      
    - name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        
    - name: Create simple JAR with all source files
      run: |
        # Create directory structure
        mkdir -p build/simple-jar
        
        # Copy all Java files maintaining package structure
        find src/main/java -name "*.java" -exec cp --parents {} build/simple-jar/ \;
        
        # Copy resources
        cp -r src/main/resources/* build/simple-jar/ 2>/dev/null || true
        
        # Create manifest
        echo "Manifest-Version: 1.0" > build/simple-jar/META-INF/MANIFEST.MF
        echo "Main-Class: com.cleanairheroes.CleanAirHeroes" >> build/simple-jar/META-INF/MANIFEST.MF
        echo "Implementation-Title: Clean Air Heroes" >> build/simple-jar/META-INF/MANIFEST.MF
        echo "Implementation-Version: 1.0.0" >> build/simple-jar/META-INF/MANIFEST.MF
        
        # Create directories
        mkdir -p build/libs
        
        # Create JAR with all files
        cd build/simple-jar
        jar cvfm ../libs/cleanairheroes-source-1.0.0.jar META-INF/MANIFEST.MF .
        
        # Create a second JAR with just Java classes for reference
        find . -name "*.java" | jar cvfm ../libs/cleanairheroes-java-files-1.0.0.jar META-INF/MANIFEST.MF -T -
        
        ls -la ../libs/
        
    - name: Upload Source JAR
      uses: actions/upload-artifact@v4
      with:
        name: CleanAirHeroes-Source-Files
        path: build/libs/*.jar
        retention-days: 30
        
    - name: Create Release with Source JAR
      uses: softprops/action-gh-release@v2
      with:
        tag_name: source-v${{ github.run_number }}
        name: Clean Air Heroes Source v${{ github.run_number }}
        body: |
          🌍 Clean Air Heroes - Source Code Package
          
          📦 **Bu Release İçeriği:**
          - cleanairheroes-source-1.0.0.jar (Tüm kaynak dosyalar)
          - cleanairheroes-java-files-1.0.0.jar (Sadece Java dosyaları)
          
          📚 **İçindekiler:**
          - 66 Java kaynak dosyası (100% tamamlanmış)
          - Fabric mod yapılandırma dosyaları
          - Kapsamlı dokümantasyon
          - 5 bölge, 21 görev, 16 mini oyun kodu
          
          🎓 **Kullanım:**
          Bu kaynak kod paketi geliştirici ortamında derlenebilir
          Eğitim amaçlı kod incelemesi için uygundur
          IntelliJ IDEA veya Eclipse ile açılabilir
          
          ⚠️ **Not:** Bu çalıştırılabilir mod değil, kaynak kod paketidir
          Çalıştırılabilir mod için Fabric geliştirici ortamı gerekir
          
          ✨ Source Package #${{ github.run_number }}
          
          🤖 Generated with [Claude Code](https://claude.ai/code)
          Co-Authored-By: Claude <noreply@anthropic.com>
        files: |
          build/libs/*.jar
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
