name: Simple JAR Build

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4
      
    - name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        
    - name: Create simple JAR with all source files
      run: |
        # Create directory structure
        mkdir -p build/simple-jar
        
        # Copy all Java files maintaining package structure
        find src/main/java -name "*.java" -exec cp --parents {} build/simple-jar/ \;
        
        # Copy resources
        cp -r src/main/resources/* build/simple-jar/ 2>/dev/null || true
        
        # Create manifest
        echo "Manifest-Version: 1.0" > build/simple-jar/META-INF/MANIFEST.MF
        echo "Main-Class: com.cleanairheroes.CleanAirHeroes" >> build/simple-jar/META-INF/MANIFEST.MF
        echo "Implementation-Title: Clean Air Heroes" >> build/simple-jar/META-INF/MANIFEST.MF
        echo "Implementation-Version: 1.0.0" >> build/simple-jar/META-INF/MANIFEST.MF
        
        # Create directories
        mkdir -p build/libs
        
        # Create JAR with all files
        cd build/simple-jar
        jar cvfm ../libs/cleanairheroes-source-1.0.0.jar META-INF/MANIFEST.MF .
        
        # Create a second JAR with just Java classes for reference
        find . -name "*.java" | jar cvfm ../libs/cleanairheroes-java-files-1.0.0.jar META-INF/MANIFEST.MF -T -
        
        ls -la ../libs/
        
    - name: Upload Source JAR
      uses: actions/upload-artifact@v4
      with:
        name: CleanAirHeroes-Source-Files
        path: build/libs/*.jar
        retention-days: 30
        
    - name: Create Release with Source JAR
      uses: softprops/action-gh-release@v2
      with:
        tag_name: source-v${{ github.run_number }}
        name: Clean Air Heroes Source v${{ github.run_number }}
        body: |
          ğŸŒ Clean Air Heroes - Source Code Package
          
          ğŸ“¦ **Bu Release Ä°Ã§eriÄŸi:**
          - cleanairheroes-source-1.0.0.jar (TÃ¼m kaynak dosyalar)
          - cleanairheroes-java-files-1.0.0.jar (Sadece Java dosyalarÄ±)
          
          ğŸ“š **Ä°Ã§indekiler:**
          - 66 Java kaynak dosyasÄ± (100% tamamlanmÄ±ÅŸ)
          - Fabric mod yapÄ±landÄ±rma dosyalarÄ±
          - KapsamlÄ± dokÃ¼mantasyon
          - 5 bÃ¶lge, 21 gÃ¶rev, 16 mini oyun kodu
          
          ğŸ“ **KullanÄ±m:**
          Bu kaynak kod paketi geliÅŸtirici ortamÄ±nda derlenebilir
          EÄŸitim amaÃ§lÄ± kod incelemesi iÃ§in uygundur
          IntelliJ IDEA veya Eclipse ile aÃ§Ä±labilir
          
          âš ï¸ **Not:** Bu Ã§alÄ±ÅŸtÄ±rÄ±labilir mod deÄŸil, kaynak kod paketidir
          Ã‡alÄ±ÅŸtÄ±rÄ±labilir mod iÃ§in Fabric geliÅŸtirici ortamÄ± gerekir
          
          âœ¨ Source Package #${{ github.run_number }}
          
          ğŸ¤– Generated with [Claude Code](https://claude.ai/code)
          Co-Authored-By: Claude <noreply@anthropic.com>
        files: |
          build/libs/*.jar
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
